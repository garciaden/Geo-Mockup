<nav class="navbar navbar-expand-lg" style="background-color:#7b2b43;">
  <div class="container-fluid">
    <!-- Logo/Home Button -->
    <a class="navbar-brand d-flex align-items-center text-white" href="{{ url_for('main.index') }}" title="Home">
      <span class="fw-bold d-none d-lg-inline">KuehnLab</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <!-- Search Bar -->
      <form class="d-flex mx-auto my-2 my-lg-0" style="max-width: 500px; width: 100%;" method="GET" action="{{ url_for('main.index') }}">
        <div class="input-group">
          <input class="form-control"
                 type="search"
                 name="search"
                 placeholder="Search by project name or owner..."
                 aria-label="Search"
                 value="{{ request.args.get('search', '') }}">
          <button class="btn btn-light" type="submit">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </form>

      <!-- Admin Menu (only for Administrators) -->
      <ul class="navbar-nav ms-auto">
        {% if session.get('is_authenticated') and session.get('user', {}).get('role') == 'Administrator' %}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle text-white d-flex align-items-center" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-database me-1"></i>
              <span>Admin Views</span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="adminDropdown">
              <li>
                <a class="dropdown-item" href="{{ url_for('main.all_samples') }}">
                  <i class="bi bi-collection me-2"></i>All Samples
                </a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item" href="{{ url_for('main.all_geochemical') }}">
                  <i class="bi bi-bar-chart me-2"></i>All Geochemical
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="{{ url_for('main.all_microanalysis') }}">
                  <i class="bi bi-grid-3x3-gap me-2"></i>All Microanalysis
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="{{ url_for('main.all_physical') }}">
                  <i class="bi bi-beaker me-2"></i>All Physical Analysis
                </a>
              </li>
            </ul>
          </li>
        {% endif %}
      </ul>

      <!-- User Menu -->
      <ul class="navbar-nav">
        {% if session.get('is_authenticated') %}
          <!-- Logged in: Show user info and logout -->
          {% set user = session.get('user', {}) %}

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle text-white d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle me-1"></i>
              <span class="fw-semibold">{{ user.get('username', 'User') }}</span>
              <span class="badge bg-light text-dark ms-2">{{ user.get('role', 'Unknown') }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li>
                <div class="dropdown-header">
                  <div class="fw-bold">{{ user.get('username', 'User') }}</div>
                  <small class="text-muted">{{ user.get('email', '') }}</small>
                </div>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li><span class="dropdown-item-text"><strong>Permissions:</strong></span></li>
              <li>
                <span class="dropdown-item-text small">
                  {% if user.get('can_create_projects') %}<i class="bi bi-check-circle-fill text-success"></i>{% else %}<i class="bi bi-x-circle text-muted"></i>{% endif %} Create Projects<br>
                  {% if user.get('can_edit_sample') %}<i class="bi bi-check-circle-fill text-success"></i>{% else %}<i class="bi bi-x-circle text-muted"></i>{% endif %} Edit Samples<br>
                  {% if user.get('can_manage_analysis') %}<i class="bi bi-check-circle-fill text-success"></i>{% else %}<i class="bi bi-x-circle text-muted"></i>{% endif %} Manage Analysis<br>
                  {% if user.get('can_export_data') %}<i class="bi bi-check-circle-fill text-success"></i>{% else %}<i class="bi bi-x-circle text-muted"></i>{% endif %} Export Data
                </span>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}">
                  <i class="bi bi-box-arrow-right"></i> Logout
                </a>
              </li>
            </ul>
          </li>
        {% else %}
          <!-- Not logged in: Show login button -->
          <li class="nav-item">
            <a class="btn btn-outline-light" href="{{ url_for('auth.login') }}">
              <i class="bi bi-box-arrow-in-right me-1"></i>Login / Register
            </a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>
