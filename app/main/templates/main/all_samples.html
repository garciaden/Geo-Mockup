{% extends "base.html" %}
{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-1">All Samples</h1>
      <p class="text-muted mb-0">System-wide view of all samples across all projects</p>
    </div>
    <div>
      <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Back to Projects
      </a>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted mb-1">Total Samples</h6>
          <h3 class="mb-0">{{ samples|length }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted mb-1">Active</h6>
          <h3 class="mb-0 text-success">{{ samples|selectattr('status', 'equalto', 'Active')|list|length }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted mb-1">With Analysis</h6>
          <h3 class="mb-0 text-primary">{{ samples|selectattr('has_geochem', 'equalto', true)|list|length + samples|selectattr('has_micro', 'equalto', true)|list|length + samples|selectattr('has_physical', 'equalto', true)|list|length }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted mb-1">Archived</h6>
          <h3 class="mb-0 text-secondary">{{ samples|selectattr('status', 'equalto', 'Archived')|list|length }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Samples Table -->
  <div class="card shadow-sm border-0">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Sample ID</th>
              <th>Lab Catalog #</th>
              <th>Short Description</th>
              <th>Project</th>
              <th>Owner</th>
              <th>Collection Date</th>
              <th>Status</th>
              <th class="text-center">Analysis</th>
            </tr>
          </thead>
          <tbody>
            {% for sample in samples %}
              <tr>
                <td>
                  <a href="{{ url_for('samples.sample_detail', sample_code=sample.sample_id) }}" class="text-decoration-none fw-semibold">
                    {{ sample.sample_id }}
                  </a>
                </td>
                <td><span class="text-muted">{{ sample.lab_catalog }}</span></td>
                <td>{{ sample.short_description }}</td>
                <td>{{ sample.project_title }}</td>
                <td>{{ sample.project_owner }}</td>
                <td>{{ sample.collection_date }}</td>
                <td>
                  <span class="badge {% if sample.status == 'Active' %}bg-success{% else %}bg-secondary{% endif %}">
                    {{ sample.status }}
                  </span>
                </td>
                <td class="text-center">
                  {% if sample.has_physical %}
                    <i class="bi bi-beaker text-success" title="Physical Analysis" data-bs-toggle="tooltip"></i>
                  {% endif %}
                  {% if sample.has_micro %}
                    <i class="bi bi-grid-3x3-gap text-success" title="Microanalysis" data-bs-toggle="tooltip"></i>
                  {% endif %}
                  {% if sample.has_geochem %}
                    <i class="bi bi-bar-chart text-success" title="Geochemical Analysis" data-bs-toggle="tooltip"></i>
                  {% endif %}
                  {% if not sample.has_physical and not sample.has_micro and not sample.has_geochem %}
                    <span class="text-muted">â€”</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Initialize Bootstrap Tooltips -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });
  </script>
{% endblock %}
